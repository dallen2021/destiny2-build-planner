<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edge of Fate Build Planner</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="api.js"></script>
    <script src="manifest.js"></script>
    <script src="app.js" defer></script>
  </head>
  <body>
    <div id="loadingOverlay" class="loading-overlay">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <p>Loading Destiny 2 Build Planner...</p>
      </div>
    </div>

    <!-- Hamburger Menu -->
    <div class="hamburger-menu" onclick="toggleSideMenu()">
      <span></span>
      <span></span>
      <span></span>
    </div>

    <!-- Side Menu -->
    <div id="sideMenu" class="side-menu">
      <div class="side-menu-header">
        <h3>Menu</h3>
        <button class="close-menu" onclick="toggleSideMenu()">√ó</button>
      </div>
      <div class="side-menu-content">
        <a href="#" onclick="switchTab('armorDisplay')">Armor Display</a>
        <a href="#" onclick="switchTab('loadoutBuilder')">Loadout Builder</a>
        <a href="#" onclick="switchTab('artifactMods')">Artifact Mods</a>
        <a href="#" onclick="switchTab('damageCalculator')"
          >Damage Calculator</a
        >
        <a href="#" onclick="switchTab('buildInfo')">Build Info</a>
        <hr />
        <a href="#" onclick="refreshData()">Refresh Data</a>
        <a href="#" onclick="openSettings()">Settings</a>
        <hr />
        <a href="#" onclick="API.auth.logout()">Sign Out</a>
      </div>
    </div>

    <!-- Header -->
    <header class="header">
      <h1>Edge of Fate Build Planner</h1>
      <p>Comprehensive Damage Calculator & Build Optimization Tool</p>

      <!-- Auth Status Bar -->
      <div class="auth-status-bar">
        <div id="userInfo" class="user-info" style="display: none">
          <span>üë§</span>
          <span id="username">Guardian</span>
        </div>
        <button id="authButton" class="auth-button-small">
          Sign in with Bungie
        </button>
      </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="nav-tabs">
      <div class="character-selector" id="characterSelector"></div>
      <div class="nav-tab" onclick="switchTab('armorDisplay')">Armor</div>
      <div class="nav-tab active" onclick="switchTab('loadoutBuilder')">
        Loadout Builder
      </div>
      <div class="nav-tab" onclick="switchTab('artifactMods')">
        Artifact Mods
      </div>
      <div class="nav-tab" onclick="switchTab('damageCalculator')">
        Damage Calculator
      </div>
      <div class="nav-tab" onclick="switchTab('buildInfo')">Build Info</div>
    </nav>

    <!-- Armor Display Section -->
    <section id="armorDisplay" class="content-section">
      <div class="armor-filters">
        <input
          type="text"
          id="armorSearchInput"
          class="armor-search"
          placeholder="Search armor..."
        />
        <select id="armorClassFilter" class="filter-select">
          <option value="all">All Classes</option>
          <option value="0">Titan</option>
          <option value="1">Hunter</option>
          <option value="2">Warlock</option>
        </select>
        <select id="armorSlotFilter" class="filter-select">
          <option value="all">All Slots</option>
          <option value="3448274439">Helmet</option>
          <option value="3551918588">Gauntlets</option>
          <option value="14239492">Chest</option>
          <option value="20886954">Legs</option>
          <option value="1585787867">Class Item</option>
        </select>
      </div>

      <div class="inventory-layout">
        <div class="inventory-column">
          <h2>Character</h2>
          <div id="character-inventories"></div>
        </div>
        <div class="inventory-column">
          <h2>Vault</h2>
          <div id="vault-items-container"></div>
        </div>
      </div>
    </section>

    <!-- Loadout Builder Section (formerly Stat Allocator) -->
    <section id="loadoutBuilder" class="content-section active">
      <div id="statAllocator" class="stat-allocator"></div>
    </section>

    <!-- Artifact Mods Section -->
    <section id="artifactMods" class="content-section">
      <div class="artifact-filters" id="artifactFilters">
        <button class="element-filter-btn" data-element="solar">Solar</button>
        <button class="element-filter-btn" data-element="arc">Arc</button>
        <button class="element-filter-btn" data-element="void">Void</button>
        <button class="element-filter-btn" data-element="stasis">Stasis</button>
        <button class="element-filter-btn" data-element="strand">Strand</button>
      </div>
      <div class="counter">
        Selected Mods: <span id="modCount">0</span> / 12
      </div>
      <div id="columnsWrapper" class="columns-wrapper"></div>
      <div class="unlock-info">
        <p><strong>Unlock Requirements:</strong></p>
        <p>
          Column 2: 3 mods in Column 1 | Column 3: 5 total mods | Column 4: 8
          total mods | Column 5: 10 total mods (max 2 selections)
        </p>
      </div>
      <button class="reset-button" onclick="resetSelection()">
        Reset Selection
      </button>
    </section>

    <!-- Damage Calculator Section -->
    <section id="damageCalculator" class="content-section calc-container">
      <div class="calc-row">
        <div class="calc-section">
          <h2>Damage Buffs & Multipliers</h2>

          <div class="buff-category">
            <h3>Global Buffs</h3>
            <div class="buff-item">
              <input
                type="checkbox"
                id="newGearWeapon"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="newGearWeapon" class="buff-label"
                >New Gear Weapon Bonus (Artifact)</label
              ><span class="buff-value">+10%</span>
            </div>
            <div class="buff-item" id="theoreticalWellBuffContainer">
              <input
                type="checkbox"
                id="theoreticalWellBuff"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="theoreticalWellBuff" class="buff-label"
                >Theoretical Well User Buff (Super >= 110)</label
              ><span class="buff-value">+15%</span>
            </div>
            <p>‚ö†Ô∏è Empowering Buffs (only highest applies):</p>
            <div class="buff-item">
              <input
                type="checkbox"
                id="radiant"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="radiant" class="buff-label">Radiant</label
              ><span class="buff-value">+25%</span>
            </div>
            <div class="buff-item">
              <input
                type="checkbox"
                id="wellOfRadiance"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="wellOfRadiance" class="buff-label"
                >Well of Radiance</label
              ><span class="buff-value">+25%</span>
            </div>
            <div class="buff-item">
              <input
                type="checkbox"
                id="nobleRounds"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="nobleRounds" class="buff-label">Noble Rounds</label
              ><span class="buff-value">+35%</span>
            </div>
            <p>‚ö†Ô∏è Weapon Damage Buffs (only highest applies):</p>
            <div class="buff-item">
              <input
                type="checkbox"
                id="weaponSurge3x"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="weaponSurge3x" class="buff-label"
                >Weapon Surge (3x)</label
              ><span class="buff-value">+22%</span>
            </div>
          </div>

          <div class="buff-category">
            <h3>Weapon Perks (All Stack Multiplicatively)</h3>
            <div class="buff-item">
              <input
                type="checkbox"
                id="elementalOverdrive"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="elementalOverdrive" class="buff-label"
                >Elemental Overdrive (Artifact)</label
              ><span class="buff-value">+25%</span>
            </div>
            <div class="buff-item">
              <input
                type="checkbox"
                id="killClip"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="killClip" class="buff-label">Kill Clip</label
              ><span class="buff-value">+25%</span>
            </div>
            <div class="buff-item">
              <input
                type="checkbox"
                id="vorpalWeapon"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="vorpalWeapon" class="buff-label"
                >Vorpal Weapon</label
              ><span class="buff-value">+15%</span>
            </div>
            <div class="buff-item">
              <input
                type="checkbox"
                id="frenzy"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="frenzy" class="buff-label">Frenzy</label
              ><span class="buff-value">+15%</span>
            </div>
            <div class="buff-item">
              <input
                type="checkbox"
                id="baitSwitch"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="baitSwitch" class="buff-label"
                >Bait and Switch</label
              ><span class="buff-value">+30%</span>
            </div>
            <div class="buff-item">
              <input
                type="checkbox"
                id="radiantShrapnel"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="radiantShrapnel" class="buff-label"
                >Radiant Shrapnel (Artifact)</label
              ><span class="buff-value">+15%</span>
            </div>
          </div>

          <div class="buff-category">
            <h3>Debuffs (Enemy)</h3>
            <p>‚ö†Ô∏è Only highest "Weaken" debuff applies:</p>
            <div class="buff-item">
              <input
                type="checkbox"
                id="weakenDebuff"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="weakenDebuff" class="buff-label"
                >Weaken (Void)</label
              ><span class="buff-value">+15%</span>
            </div>
            <div class="buff-item">
              <input
                type="checkbox"
                id="tetherDebuff"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="tetherDebuff" class="buff-label"
                >Shadowshot Tether</label
              ><span class="buff-value">+30%</span>
            </div>
            <div class="buff-item">
              <input
                type="checkbox"
                id="divinityDebuff"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="divinityDebuff" class="buff-label">Divinity</label
              ><span class="buff-value">+15%</span>
            </div>
            <div class="buff-item">
              <input
                type="checkbox"
                id="tractorCannon"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="tractorCannon" class="buff-label"
                >Tractor Cannon</label
              ><span class="buff-value">+30%</span>
            </div>
          </div>

          <div class="damage-output">
            <h3>Total Weapon Damage</h3>
            <div id="weaponDamageResult" class="damage-result">100%</div>
            <div id="weaponBreakdown" class="damage-breakdown">Base damage</div>
          </div>
        </div>

        <div class="calc-section">
          <h2>Melee & Ability Damage</h2>

          <div class="buff-category">
            <h3>Class Selection</h3>
            <div class="class-selector">
              <button
                class="class-button"
                data-class="hunter"
                onclick="selectClass('hunter')"
              >
                Hunter
              </button>
              <button
                class="class-button"
                data-class="titan"
                onclick="selectClass('titan')"
              >
                Titan
              </button>
              <button
                class="class-button"
                data-class="warlock"
                onclick="selectClass('warlock')"
              >
                Warlock
              </button>
            </div>
          </div>

          <div class="buff-category">
            <h3>Melee Buffs (Additive)</h3>
            <div class="buff-item">
              <input
                type="checkbox"
                id="onetwoPunch"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
              /><label for="onetwoPunch" class="buff-label">One-Two Punch</label
              ><span class="buff-value">+300%</span>
            </div>
            <div class="buff-item">
              <input
                type="checkbox"
                id="roaringFlames"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
                data-melee-classes="titan"
              /><label for="roaringFlames" class="buff-label"
                >Roaring Flames (3√ó)</label
              ><span class="buff-value">+200%</span>
            </div>
            <div class="buff-item">
              <input
                type="checkbox"
                id="bannerOfWar"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
                data-melee-classes="titan"
              /><label for="bannerOfWar" class="buff-label">Banner of War</label
              ><span class="buff-value">+100%</span>
            </div>
            <div class="buff-item">
              <input
                type="checkbox"
                id="combinationBlow"
                class="buff-checkbox"
                onchange="recalculateAllDamage()"
                data-melee-classes="hunter"
              /><label for="combinationBlow" class="buff-label"
                >Combination Blow (3√ó)</label
              ><span class="buff-value">+165%</span>
            </div>
          </div>

          <div class="buff-category">
            <h3>Exotic Armor Buffs</h3>
            <div
              class="buff-item"
              data-exotic="exoticClassItem"
              data-column="0"
            >
              <input
                type="checkbox"
                id="exoticClassItem"
                class="exotic-checkbox"
                onchange="updateExoticRestrictions(); recalculateAllDamage()"
              /><label for="exoticClassItem" class="buff-label">
                Using Exotic Class Item (allows 2 exotic perks)</label
              >
            </div>

            <div class="hunter-exotics exotic-group">
              <div
                class="buff-item"
                data-exotic="liarsHandshake"
                data-column="1"
              >
                <input
                  type="checkbox"
                  id="liarsHandshake"
                  class="exotic-checkbox"
                  onchange="handleExoticSelection('liarsHandshake'); recalculateAllDamage()"
                /><label for="liarsHandshake" class="buff-label"
                  >Liar's Handshake</label
                ><span class="buff-value">+400%</span>
              </div>
              <div
                class="buff-item"
                data-exotic="assassinsCowl"
                data-column="1"
              >
                <input
                  type="checkbox"
                  id="assassinsCowl"
                  class="exotic-checkbox"
                  onchange="handleExoticSelection('assassinsCowl'); recalculateAllDamage()"
                /><label for="assassinsCowl" class="buff-label"
                  >Assassin's Cowl</label
                ><span class="buff-value">+150%</span>
              </div>
              <div class="buff-item" data-exotic="caliban" data-column="1">
                <input
                  type="checkbox"
                  id="caliban"
                  class="exotic-checkbox"
                  onchange="handleExoticSelection('caliban'); recalculateAllDamage()"
                /><label for="caliban" class="buff-label">Caliban's Hand</label
                ><span class="buff-value">+100%</span>
              </div>
              <div
                class="buff-item"
                data-exotic="synthocepsHunter"
                data-column="2"
              >
                <input
                  type="checkbox"
                  id="synthocepsHunter"
                  class="exotic-checkbox"
                  onchange="handleExoticSelection('synthocepsHunter'); recalculateAllDamage()"
                /><label for="synthocepsHunter" class="buff-label"
                  >Synthoceps (Class Item)</label
                ><span class="buff-value">+400%</span>
              </div>
            </div>

            <div class="titan-exotics exotic-group" style="display: none">
              <div
                class="buff-item"
                data-exotic="synthocepsTitan"
                data-column="2"
              >
                <input
                  type="checkbox"
                  id="synthocepsTitan"
                  class="exotic-checkbox"
                  onchange="handleExoticSelection('synthocepsTitan'); recalculateAllDamage()"
                /><label for="synthocepsTitan" class="buff-label"
                  >Synthoceps (Surrounded)</label
                ><span class="buff-value">+400%</span>
              </div>
              <div
                class="buff-item"
                data-exotic="wormgodCaress"
                data-column="2"
              >
                <input
                  type="checkbox"
                  id="wormgodCaress"
                  class="exotic-checkbox"
                  onchange="handleExoticSelection('wormgodCaress'); recalculateAllDamage()"
                /><label for="wormgodCaress" class="buff-label"
                  >Wormgod Caress (5√ó)</label
                ><span class="buff-value">+400%</span>
              </div>
              <div
                class="buff-item"
                data-exotic="severanceEnclosure"
                data-column="1"
              >
                <input
                  type="checkbox"
                  id="severanceEnclosure"
                  class="exotic-checkbox"
                  onchange="handleExoticSelection('severanceEnclosure'); recalculateAllDamage()"
                /><label for="severanceEnclosure" class="buff-label"
                  >Severance Enclosure</label
                ><span class="buff-value">+200%</span>
              </div>
            </div>

            <div class="warlock-exotics exotic-group" style="display: none">
              <div class="buff-item" data-exotic="wintersGuile" data-column="2">
                <input
                  type="checkbox"
                  id="wintersGuile"
                  class="exotic-checkbox"
                  onchange="handleExoticSelection('wintersGuile'); recalculateAllDamage()"
                /><label for="wintersGuile" class="buff-label"
                  >Winter's Guile (5√ó)</label
                ><span class="buff-value">+400%</span>
              </div>
              <div class="buff-item" data-exotic="necroticGrip" data-column="1">
                <input
                  type="checkbox"
                  id="necroticGrip"
                  class="exotic-checkbox"
                  onchange="handleExoticSelection('necroticGrip'); recalculateAllDamage()"
                /><label for="necroticGrip" class="buff-label"
                  >Necrotic Grip</label
                ><span class="buff-value">+100%</span>
              </div>
              <div
                class="buff-item"
                data-exotic="synthocepsWarlock"
                data-column="2"
              >
                <input
                  type="checkbox"
                  id="synthocepsWarlock"
                  class="exotic-checkbox"
                  onchange="handleExoticSelection('synthocepsWarlock'); recalculateAllDamage()"
                /><label for="synthocepsWarlock" class="buff-label"
                  >Synthoceps (Class Item)</label
                ><span class="buff-value">+400%</span>
              </div>
            </div>
          </div>

          <div class="damage-output">
            <h3>Total Melee Damage</h3>
            <div id="meleeDamageResult" class="damage-result">100%</div>
            <div id="meleeBreakdown" class="damage-breakdown">
              Base damage (additive)
            </div>
          </div>

          <div class="damage-output">
            <h3>Total Grenade Damage</h3>
            <div id="grenadeDamageResult" class="damage-result">100%</div>
            <div id="grenadeBreakdown" class="damage-breakdown">
              Base damage
            </div>
          </div>

          <div class="damage-output">
            <h3>Total Super Damage</h3>
            <div id="superDamageResult" class="damage-result">100%</div>
            <div id="superBreakdown" class="damage-breakdown">Base damage</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Build Info Section -->
    <section id="buildInfo" class="content-section">
      <div class="info-grid">
        <div class="info-card">
          <h3>Damage Stacking Rules</h3>
          <table class="info-table">
            <tr>
              <th>Category</th>
              <th>Stacking Rule</th>
            </tr>
            <tr>
              <td>Empowering Buffs</td>
              <td>Only highest applies (Radiant, Well, Noble Rounds)</td>
            </tr>
            <tr>
              <td>Weapon Damage Buffs</td>
              <td>Only highest applies (e.g., Surge mods)</td>
            </tr>
            <tr>
              <td>Weapon Perks & Artifact Buffs</td>
              <td>All stack multiplicatively (e.g., Kill Clip, Overdrive)</td>
            </tr>
            <tr>
              <td>Enemy Debuffs</td>
              <td>Only highest "Weaken" effect applies</td>
            </tr>
            <tr>
              <td>Melee Buffs</td>
              <td>Most stack additively (except some exotics)</td>
            </tr>
          </table>
        </div>

        <div class="info-card">
          <h3>Stat Tier Breakpoints</h3>
          <table class="info-table">
            <tr>
              <th>Stat Value</th>
              <th>Key Benefits</th>
            </tr>
            <tr>
              <td>10</td>
              <td>Minimum stat level, initial bonus scaling begins</td>
            </tr>
            <tr>
              <td>50</td>
              <td>
                First major bonus threshold, significant cooldown reduction
              </td>
            </tr>
            <tr>
              <td>100</td>
              <td>
                Maximum base cooldown reduction, unlocks secondary benefits
              </td>
            </tr>
            <tr>
              <td>110</td>
              <td>First threshold for enhanced super/ability damage</td>
            </tr>
            <tr>
              <td>150</td>
              <td>Additional passive benefits (ammo chance, etc.)</td>
            </tr>
            <tr>
              <td>200</td>
              <td>Maximum damage bonuses and secondary effects</td>
            </tr>
          </table>
        </div>

        <div class="info-card">
          <h3>Exotic Class Item Combinations</h3>
          <table class="info-table">
            <tr>
              <th>Class</th>
              <th>Popular Combinations</th>
            </tr>
            <tr>
              <td>Hunter</td>
              <td>
                Assassin's Cowl + Synthoceps<br />Caliban's Hand + Liar's
                Handshake
              </td>
            </tr>
            <tr>
              <td>Titan</td>
              <td>
                Severance Enclosure + Synthoceps<br />Severance Enclosure +
                Synthoceps (PvE melee)
              </td>
            </tr>
            <tr>
              <td>Warlock</td>
              <td>
                Necrotic Grip + Synthoceps<br />Necrotic Grip + Synthoceps
                (melee builds)
              </td>
            </tr>
          </table>
        </div>

        <div class="info-card">
          <h3>Artifact Mod Synergies</h3>
          <table class="info-table">
            <tr>
              <th>Mod Combination</th>
              <th>Effect</th>
            </tr>
            <tr>
              <td>Elemental Overdrive + Surge Mods</td>
              <td>Stacks for a significant (25% + 22%) damage boost</td>
            </tr>
            <tr>
              <td>Radiant Shrapnel + Solar Weapons</td>
              <td>Chain explosions while Radiant for add clear</td>
            </tr>
            <tr>
              <td>Shieldcrush + Tank Builds</td>
              <td>Faster ability regen while maintaining defensive buffs</td>
            </tr>
            <tr>
              <td>Frost Renewal + Stasis Builds</td>
              <td>Team-wide frost armor generation on critical damage</td>
            </tr>
          </table>
        </div>
      </div>
    </section>

    <script src="app.js"></script>
  </body>
</html>
